// $Id: R1-12.47-1.glm
// 12.5 kV feeder
//*********************************************
clock{
    timezone UTC0;
    timestamp '2000-01-01 0:00:00';
    stoptime '2000-01-01 0:01:00';

}

#set profiler=1
//*********************************************
// modules
module tape;
module generators;
module powerflow{
    solver_method NR;
    default_maximum_voltage_error 1e-6;
};

//*********************************************

object node {
    name Node1;
    bustype SWING; 
    phases ABC;
    nominal_voltage 7200.0;
}

object node {
    name Node2;
    phases ABC;
    nominal_voltage 7200.0;
}

object triplex_line {
     name batt_line;
     from Node1;
     to batt_meter;
     phases AS;
     length 10;
     configuration triplex_line_config;
}
object triplex_meter {     
     name batt_meter;
     phases AS;
     nominal_voltage 124.00;     
} 
object inverter {
      name batt_inv;
      generator_status ONLINE;
      inverter_type FOUR_QUADRANT;
      four_quadrant_control_mode LOAD_FOLLOWING;
      parent batt_meter;
      sense_object Node1;
      rated_power 3000.0;       //Per phase rating
      inverter_efficiency .95;
      charge_on_threshold 1.5 kW;
      charge_off_threshold 1.7 kW;
      discharge_off_threshold 2 kW;
      discharge_on_threshold 3 kW;
      max_discharge_rate 3 kW;
      max_charge_rate 3 kW;
      charge_lockout_time 1;
      discharge_lockout_time 1;
}
object battery {
    name batt;
    parent batt_inv;
    use_internal_battery_model TRUE;
    battery_type LI_ION;
    rated_power 3 kW;
    nominal_voltage 120;
    battery_capacity 10 kWh;
    round_trip_efficiency 0.81;
    state_of_charge 0.5;
    generator_mode SUPPLY_DRIVEN;
}

object overhead_line:201 {
    name Node1toNode2;
    phases ABC;
    from Node1;
    to Node2;
    length 60.0;
    configuration line_configuration:22;
}

object line_configuration:22 { 
     conductor_A overhead_line_conductor:3; 
     conductor_B overhead_line_conductor:3; 
     conductor_C overhead_line_conductor:3; 
     conductor_N overhead_line_conductor:3; 
     spacing line_spacing:10; 
} 

object overhead_line_conductor:3 { 
     //name 4/0 ACSR; 
     rating.summer.continuous 334.0; 
     geometric_mean_radius 0.00814 ft; 
     resistance 0.56300; 
} 

object line_spacing:10 { 
    distance_AB 57.6 in; 
    distance_BC 57.6 in; 
    distance_AC 57.6 in; 
    distance_AN 84.0 in; 
    distance_BN 84.0 in; 
    distance_CN 84.0 in; 
} 


// Recorders

object recorder {
    parent Node1;
    property voltage_A[kV];
    limit 200;
    interval 1;
    file "Node1Voltage.csv";
};

object recorder {
    parent Node1toNode2;
    property power_in;
    limit 200;
    interval 1;
    file "Node1toNode2Powerflow.csv";
};